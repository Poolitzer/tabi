function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function formatDate(e,t){return new Date(e).toLocaleDateString(t,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function emojify(o,e){return e&&0!==e.length&&e.forEach(e=>{var t=new RegExp(`:${e.shortcode}:`,"g");o=o.replace(t,`<img src="${e.url}" alt="${e.shortcode}" class="emoji" loading="lazy" />`)}),o}function renderComment(e,t){var o=escapeHtml(e.account.display_name||e.account.username),a=escapeHtml(e.account.username),n=e.account.url,r=e.account.avatar,s=emojify(e.content,e.emojis),t=formatDate(e.created_at,t),m=e.url;let d="";return e.media_attachments&&0<e.media_attachments.length&&(d='<div class="mastodon-attachments">',e.media_attachments.forEach(e=>{"image"===e.type?d+=`<a href="${e.url}" target="_blank" rel="noopener noreferrer">
                    <img src="${e.preview_url}" alt="${escapeHtml(e.description||"Image")}" loading="lazy" />
                </a>`:"video"===e.type||"gifv"===e.type?d+=`<video controls preload="metadata" poster="${e.preview_url}">
                    <source src="${e.url}" type="${e.mime_type||"video/mp4"}">
                </video>`:"audio"===e.type&&(d+=`<audio controls preload="metadata">
                    <source src="${e.url}" type="${e.mime_type||"audio/mpeg"}">
                </audio>`)}),d+="</div>"),`
        <div class="mastodon-comment">
            <div class="mastodon-comment-header">
                <img src="${r}" alt="${o}'s avatar" class="mastodon-avatar" loading="lazy" />
                <div class="mastodon-author">
                    <a href="${n}" target="_blank" rel="noopener noreferrer" class="mastodon-author-name">
                        ${o}
                    </a>
                    <a href="${n}" target="_blank" rel="noopener noreferrer" class="mastodon-author-handle">
                        @${a}
                    </a>
                </div>
                <a href="${m}" target="_blank" rel="noopener noreferrer" class="mastodon-comment-date">
                    ${t}
                </a>
            </div>
            <div class="mastodon-comment-content">
                ${s}
            </div>
            ${d}
        </div>
    `}function renderComments(e,t){return e&&0!==e.length?e.map(e=>renderComment(e,t)).join(""):'<p class="mastodon-no-comments">No comments yet. Be the first to comment on Mastodon!</p>'}async function loadMastodonComments(e,t,o){var a=document.getElementById("mastodon-comments-list");try{var n=await fetch(`https://${e}/api/v1/statuses/${t}/context`);if(!n.ok)throw new Error("HTTP error! status: "+n.status);var r=(await n.json()).descendants||[];a.innerHTML=renderComments(r,o)}catch(e){console.error("Error loading Mastodon comments:",e),a.innerHTML='<p class="mastodon-error">Failed to load comments. Please try again later.</p>'}}function initMastodon(){var e,t,o,a,n=document.querySelector(".comments");n&&(e=n.getAttribute("data-mastodon-host"),t=n.getAttribute("data-mastodon-post-id"),o=n.getAttribute("data-page-language")||"en",a=n.getAttribute("data-mastodon-post-url"),e&&t?(n.innerHTML=`
            <div class="mastodon-comments">
                <div class="mastodon-comments-header">
                    <h3>Comments</h3>
                    ${a?`<a href="${a}" target="_blank" rel="noopener noreferrer" class="mastodon-comment-link">Comment on Mastodon</a>`:""}
                </div>
                <div id="mastodon-comments-list">
                    <p class="mastodon-loading">Loading comments...</p>
                </div>
            </div>
        `,loadMastodonComments(e,t,o)):console.error("Mastodon host or post ID not configured"))}initMastodon();
